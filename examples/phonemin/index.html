<!doctype html>
<html>
        <head>
                <meta charset="utf8">
                <title>Mini synth</title>
                <link href="../../dist/AudioTags.bundle.css" rel="stylesheet" media="all" />
                <link href="../css/mini-synth.css" rel="stylesheet" media="all" />
        </head>
    <body>

        <p>A chain with a mini synth (another custom component built with audio tags), an oscilloscope and a vumeter should be created and displayed.</p>

        <audio-context>
            <audio-chain>
                <mini-synth></mini-synth>
                <audio-oscilloscope></audio-oscilloscope>
            </audio-chain>
        </audio-context>

        <audio-keyboard octaves="2"></audio-keyboard>

        <div>
            <button>Become a rockstar</button>
        </div>

        <script src="../../dist/AudioTags.bundle.js" type="text/javascript"></script>
        
        <script>
            require('AudioTags').register();
        </script>
        
        <script src="../js/mini-synth.js"></script>
        <script src="../js/positionometer.js"></script>

        <script>

            window.addEventListener('DOMComponentsLoaded', function() {

                var minisynth = document.querySelector('mini-synth');

                document.querySelector('audio-chain').output.gain.value = 0.05;

                var keyboard = document.querySelector('audio-keyboard');

                keyboard.addEventListener('noteon', function(e) {

                    var noteIndex = e.detail.index;
                    minisynth.noteOn(parseInt(noteIndex, 10) + 48);
                    minisynth.start();
                    
                }, false);

                keyboard.addEventListener('noteoff', function(e) {

                    minisynth.noteOff();
                    
                }, false);

                var btn = document.querySelector('button');
                btn.addEventListener('click', function() {
                    minisynth.classList.add('rockstar');
                    btn.innerHTML = '\\m/';
                }, false);

                var oscillators = document.querySelectorAll('audio-oscillator');
                oscillators[1].gain = 0;
                oscillators[1].frequency = 0;

                window.Positionometer.onPositionChange(function(p) {
                    console.log("freq: " + (60 + 2000 * p.y));
                    oscillators[0].frequency = 60 + 2000 * p.y;
                    console.log("gain: " + Math.abs(p.x));
                    oscillators[0].gain = Math.abs(p.x);
                });

                oscillators[0].start(0);

            }, false);

        </script>

        </body>
</html>





